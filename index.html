<!DOCTYPE html>
<html lang="en" data-bs-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Salat DZ</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üïã</text></svg>">
    <link rel="manifest" href="/manifest.json">

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
    <style>
        table {
            text-align: center;
        }
     
        body, html {
            height: 100%;
            margin: 0;
        }
   
    </style>

</head>

<body>
    <nav class="navbar bg-body-tertiary">
        <form class="container-fluid justify-content-start">
          <button class="btn btn-primary me-2" type="button" id="downloadPwaButton">ÿ™ÿ≠ŸÖŸäŸÑ</button>
          <div class="form-check form-switch text-center ms-auto">
            <input class="form-check-input" type="checkbox" id="gmtToggle">
            <label class="form-check-label" for="gmtToggle">GMT+2</label>
        </div>
        </form>
      </nav>

        <div class="container d-flex align-items-center flex-column" style="margin-top: 10vh;">
       <h1>üïã</h2>
            <h2>ŸÖŸàÿßŸÇŸäÿ™ ÿßŸÑŸÖÿ≥ŸäŸÑÿ©</h2>   
       <h6 id="current-date">----/--/--</h6>
        <h5 id="current-time">--:--:--</h5>    
    
            <table class="table table-bordered table-hover" style="margin-top: 5vh;">
                <thead class="table-active">
                    <tr>
                        <th>ŸÖÿ™ÿ®ŸÇŸä</th>
                        <th>ÿßŸÑŸàŸÇÿ™</th>
                        <th>ÿßŸÑÿµŸÑÿßÿ©</th>
                    </tr>
                </thead>
                <tbody id="table-body">
                   
                </tbody>
            </table>
        </div>
  
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" crossorigin="anonymous"></script>
    <script>
        const data = {
            "2024/10/10": [
                "05:21",
                "12:30",
                "15:45",
                "18:17",
                "19:34"
            ],
            "2024/10/11": [
                "05:21",
                "12:30",
                "15:44",
                "18:16",
                "19:33"
            ],
            "2024/10/12": [
                "05:22",
                "12:30",
                "15:43",
                "18:14",
                "19:31"
            ],
            "2024/10/13": [
                "05:23",
                "12:29",
                "15:42",
                "18:13",
                "19:30"
            ],
            "2024/10/14": [
                "05:24",
                "12:29",
                "15:41",
                "18:12",
                "19:29"
            ],
            "2024/10/15": [
                "05:25",
                "12:29",
                "15:40",
                "18:10",
                "19:27"
            ],
            "2024/10/16": [
                "05:26",
                "12:29",
                "15:39",
                "18:09",
                "19:26"
            ],
            "2024/10/17": [
                "05:27",
                "12:28",
                "15:38",
                "18:08",
                "19:25"
            ],
            "2024/10/18": [
                "05:27",
                "12:28",
                "15:37",
                "18:06",
                "19:24"
            ],
            "2024/10/19": [
                "05:28",
                "12:28",
                "15:36",
                "18:05",
                "19:22"
            ],
            "2024/10/20": [
                "05:29",
                "12:28",
                "15:35",
                "18:04",
                "19:21"
            ],
            "2024/10/21": [
                "05:30",
                "12:28",
                "15:34",
                "18:03",
                "19:20"
            ],
            "2024/10/22": [
                "05:31",
                "12:28",
                "15:33",
                "18:01",
                "19:19"
            ],
            "2024/10/23": [
                "05:32",
                "12:28",
                "15:32",
                "18:00",
                "19:18"
            ],
            "2024/10/24": [
                "05:33",
                "12:27",
                "15:31",
                "17:59",
                "19:17"
            ],
            "2024/10/25": [
                "05:34",
                "12:27",
                "15:30",
                "17:58",
                "19:15"
            ],
            "2024/10/26": [
                "05:34",
                "12:27",
                "15:29",
                "17:56",
                "19:14"
            ]
        }
    
        const today = getCurrentDate();
        const todayTimes = data[today];
    
        function getCurrentDate() {
        const today = new Date();
        const year = today.getFullYear();
        const month = String(today.getMonth() + 1).padStart(2, '0'); // Add leading zero
        const day = String(today.getDate()).padStart(2, '0'); // Add leading zero
        return `${year}/${month}/${day}`;
    }
    
    
    const prayerNames = ["ÿßŸÑŸÅÿ¨ÿ±", "ÿßŸÑÿ∏Ÿáÿ±", "ÿßŸÑÿπÿµÿ±", "ÿßŸÑŸÖÿ∫ÿ±ÿ®", "ÿßŸÑÿπÿ¥ÿßÿ°"];
        const tableBody = document.getElementById('table-body');
        const gmtToggle = document.getElementById('gmtToggle');
        const downloadPwaButton = document.getElementById('downloadPwaButton');
        const currentTimeElement = document.getElementById('current-time');
        const currentDateElement = document.getElementById('current-date');
    
        // Function to generate rows dynamically
        function generateTableRows() {
            tableBody.innerHTML = '';

            for (let i = 0; i < todayTimes.length; i++) {
                // Create a new row
                const row = document.createElement('tr');
                
                // Create a new cell for "Time Left"
                const timeLeftCell = document.createElement('td');
                timeLeftCell.textContent = "--:--:--"; // Static value
                row.appendChild(timeLeftCell);
                
                // Create a new cell for the time from the array
                const timeCell = document.createElement('td');
                timeCell.textContent = adjustTimeForGMT(todayTimes[i]);
                row.appendChild(timeCell);
                
                // Create a new cell for the prayer name
                const prayerCell = document.createElement('td');
                prayerCell.textContent = prayerNames[i];
                row.appendChild(prayerCell);
                
                // Append the row to the table body
                tableBody.appendChild(row);

                  // Start countdown for this row
            startCountdown(timeCell, timeLeftCell);
       
            }
        }
    // Function to adjust time for GMT+1 if toggle is active
    function adjustTimeForGMT(timeString) {
        const [hours, minutes] = timeString.split(':').map(Number);
        let adjustedHours = hours;

        // Check if GMT+1 is active
        if (gmtToggle.checked) {
            adjustedHours = (hours + 1) % 24; // Add 1 hour, wrap around if >= 24
        }

        return `${String(adjustedHours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}`;
    }

    // Function to start the countdown timer
function startCountdown(timeCell, timeLeftCell) {
    const targetTime = getTargetTime(timeCell.textContent);

    // Function to update the countdown
    function updateCountdown() {
        const currentTime = new Date();
        const timeDiff = targetTime - currentTime;

        if (timeDiff <= 0) {
            clearInterval(intervalId); // Stop the timer when time is up
            timeLeftCell.textContent = "00:00:00";
            return;
        }

        const hours = Math.floor(timeDiff / 1000 / 60 / 60);
        const minutes = Math.floor((timeDiff / 1000 / 60) % 60);
        const seconds = Math.floor((timeDiff / 1000) % 60);

        // Format the time as hh:mm:ss
        timeLeftCell.textContent = `${String(hours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
    }

    // Call the update function immediately
    updateCountdown();

    // Set the interval to update every second
    const intervalId = setInterval(updateCountdown, 1000);
}


    // Function to get the target time (timeCell) as a Date object for today
    function getTargetTime(timeString) {
        const [hours, minutes] = timeString.split(':').map(Number);
        const now = new Date();
        const targetTime = new Date(now.getFullYear(), now.getMonth(), now.getDate(), hours, minutes, 0, 0);
        return targetTime;
    }

      // Function to update current time and date
      function updateCurrentTimeAndDate() {
        const now = new Date();

        // Format the current time as hh:mm:ss
        const hours = String(now.getHours()).padStart(2, '0');
        const minutes = String(now.getMinutes()).padStart(2, '0');
        const seconds = String(now.getSeconds()).padStart(2, '0');
        currentTimeElement.textContent = `${hours}:${minutes}:${seconds}`;

        // Format the current date as YYYY/MM/DD
        const year = now.getFullYear();
        const month = String(now.getMonth() + 1).padStart(2, '0'); // Add 1 because months are 0-indexed
        const day = String(now.getDate()).padStart(2, '0');
        currentDateElement.textContent = `${day}/${month}/${year}`;
    }


        // Call the function to generate the rows
        generateTableRows();

           // Update current time and date every second
           updateCurrentTimeAndDate();
    setInterval(updateCurrentTimeAndDate, 1000);

         // Event listener to regenerate the table when GMT+1 toggle is activated/deactivated
    gmtToggle.addEventListener('change', generateTableRows);

    //pwa install prompt
    let deferredPrompt;
  window.addEventListener('beforeinstallprompt', (e) => {
    e.preventDefault();
    deferredPrompt = e;
    // Optionally, show the install button
    downloadPwaButton.style.display = 'block';
  });

  downloadPwaButton.addEventListener('click', () => {
    deferredPrompt.prompt();
    deferredPrompt.userChoice.then((choiceResult) => {
      if (choiceResult.outcome === 'accepted') {
        console.log('User accepted the install prompt');
      } else {
        console.log('User dismissed the install prompt');
      }
      deferredPrompt = null;
    });
  });
        </script>

        <script>
            if ('serviceWorker' in navigator) {
                window.addEventListener('load', () => {
                    navigator.serviceWorker.register('/service-worker.js')
                        .then(registration => {
                            console.log('ServiceWorker registration successful with scope: ', registration.scope);
                        })
                        .catch(error => {
                            console.log('ServiceWorker registration failed: ', error);
                        });
                });
            }
        </script>
</body>
</html>